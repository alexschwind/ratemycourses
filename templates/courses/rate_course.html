{% extends "allauth/layouts/base.html" %}
{% block title %}Rate {{course.name}}{% endblock %}
{% block extra_head %}
<style>
.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
}

.form-group input[type="number"],
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.error {
    color: #dc3545;
    font-size: 0.875rem;
    margin-top: 0.25rem;
}

button[type="submit"] {
    background-color: #007bff;
    color: white;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 1rem;
}

button[type="submit"]:hover {
    background-color: #0056b3;
}

/* Star Rating Styles */
.star-rating-container {
    margin: 1rem 0;
}

.star-rating .stars {
    display: flex;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
}

.star-rating .star {
    font-size: 2rem;
    color: #ddd;
    cursor: pointer;
    transition: color 0.2s ease;
    user-select: none;
}

.star-rating .star:hover,
.star-rating .star.active {
    color: #ffc107;
}

.star-rating .star:hover ~ .star {
    color: #ddd;
}

.rating-text {
    font-size: 0.9rem;
    color: #666;
    margin-top: 0.5rem;
}

.rating-value {
    font-weight: bold;
    color: #333;
}

.rating-input {
    display: none !important;
}

.info-message {
    background-color: #d1ecf1;
    color: #0c5460;
    padding: 0.75rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    border: 1px solid #bee5eb;
}
</style>
{% endblock %}
{% block extra_body %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const starRating = document.querySelector('.star-rating');
    if (!starRating) return;
    
    const stars = starRating.querySelectorAll('.star');
    const hiddenInput = starRating.parentElement.querySelector('.rating-input');
    const ratingValue = starRating.querySelector('.rating-value');
    const currentRating = parseInt(starRating.dataset.rating) || 0;
    
    // Set initial state
    updateStars(currentRating);
    
    stars.forEach((star, index) => {
        star.addEventListener('click', function() {
            const value = parseInt(this.dataset.value);
            updateStars(value);
            hiddenInput.value = value;
            ratingValue.textContent = value;
        });
        
        star.addEventListener('mouseenter', function() {
            const value = parseInt(this.dataset.value);
            updateStars(value);
        });
    });
    
    starRating.addEventListener('mouseleave', function() {
        const currentValue = parseInt(hiddenInput.value) || 0;
        updateStars(currentValue);
    });
    
    function updateStars(rating) {
        stars.forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }
});
</script>
{% endblock %}
{% block content %}
<h2>{% if existing_rating %}Edit Rating:{% else %}Rate:{% endif %} {{ course.name }}</h2>
{% if existing_rating %}
<p class="info-message">You already rated this course. You can update your rating below.</p>
{% endif %}
<form method="post">
  {% csrf_token %}
  
  <div class="form-group">
    <label for="{{ form.rating.id_for_label }}">Rating:</label>
    <div class="star-rating-container">
      <div class="star-rating" data-rating="{{ form.rating.value|default:0 }}">
        <div class="stars">
          <span class="star" data-value="1">★</span>
          <span class="star" data-value="2">★</span>
          <span class="star" data-value="3">★</span>
          <span class="star" data-value="4">★</span>
          <span class="star" data-value="5">★</span>
        </div>
        <div class="rating-text">
          <span class="rating-value">{{ form.rating.value|default:0 }}</span>/5
        </div>
      </div>
      {{ form.rating }}
    </div>
    {% if form.rating.errors %}
      <div class="error">{{ form.rating.errors }}</div>
    {% endif %}
  </div>
  
  <div class="form-group">
    <label for="{{ form.comment.id_for_label }}">Comment:</label>
    {{ form.comment }}
    {% if form.comment.errors %}
      <div class="error">{{ form.comment.errors }}</div>
    {% endif %}
  </div>
  
  <div class="form-group">
    <label for="{{ form.year.id_for_label }}">Year:</label>
    {{ form.year }}
    {% if form.year.errors %}
      <div class="error">{{ form.year.errors }}</div>
    {% endif %}
  </div>
  
  <div class="form-group">
    <label for="{{ form.semester.id_for_label }}">Semester:</label>
    {{ form.semester }}
    {% if form.semester.errors %}
      <div class="error">{{ form.semester.errors }}</div>
    {% endif %}
  </div>
  
  <button type="submit">Save</button>
</form>
<p><a href="{% url 'course_detail' course.slug %}">Back to course</a></p>
{% endblock %}